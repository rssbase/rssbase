#!/usr/bin/env bash
set -eou pipefail
if [ "${1:-}" == '-d' ] || [ "${1:-}" == '--debug' ]; then
    set -x
    shift
fi

FIG="docker compose"

(
$FIG ps tools --quiet > /dev/null || $FIG up \
    --build \
    --detach \
    --quiet-pull \
    --no-deps \
    --wait \
    tools
) 2> /dev/null

if [ $# -eq 0 ]; then
    ARGS="bash"
else
    ARGS="$@"
fi

exec $FIG exec \
    ${COMPOSE_OPTIONS:-} \
    tools "${ARGS}"
